BlacklistedWeapons = { -- Weapons that are detected
"WEAPON_REMOTESNIPER",
"WEAPON_GRENADELAUNCHER",
"WEAPON_GRENADELAUNCHER_SMOKE",
"WEAPON_RPG",
"WEAPON_PASSENGER_ROCKET",
"WEAPON_AIRSTRIKE_ROCKET",
"WEAPON_STINGER",
"WEAPON_STICKYBOMB",
"WEAPON_DIGISCANNER",
"WEAPON_BRIEFCASE",
"WEAPON_MICROSMG",
"WEAPON_BRIEFCASE_02",
"WEAPON_VEHICLE_ROCKET",
"WEAPON_BARBED_WIRE",
"WEAPON_DROWNING",
"WEAPON_DROWNING_IN_VEHICLE",
"WEAPON_BLEEDING",
"WEAPON_ELECTRIC_FENCE",
"WEAPON_FIRE",
"WEAPON_GUSENBERG",
"WEAPON_FIREWORK",
"WEAPON_MARKSMANRIFLE",
"WEAPON_HOMINGLAUNCHER",
"WEAPON_PROXMINE",
"WEAPON_RAILGUN",
"WEAPON_AIR_DEFENCE_GUN",
"WEAPON_AUTOSHOTGUN",
"WEAPON_COMPACTLAUNCHER",
"WEAPON_PIPEBOMB",
"VEHICLE_WEAPON_ROTORS",
"VEHICLE_WEAPON_TANK",
"VEHICLE_WEAPON_SPACE_ROCKET",
"VEHICLE_WEAPON_PLANE_ROCKET",
"VEHICLE_WEAPON_PLAYER_LAZER",
"VEHICLE_WEAPON_PLAYER_LASER",
"VEHICLE_WEAPON_PLAYER_BULLET",
"VEHICLE_WEAPON_PLAYER_BUZZARD",
"VEHICLE_WEAPON_PLAYER_HUNTER",
"VEHICLE_WEAPON_ENEMY_LASER",
"VEHICLE_WEAPON_SEARCHLIGHT",
"VEHICLE_WEAPON_RADAR",
"VEHICLE_WEAPON_TURRET_INSURGENT",
"VEHICLE_WEAPON_TURRET_TECHNICAL",
"VEHICLE_WEAPON_NOSE_TURRET_VALKYRIE",
"VEHICLE_WEAPON_PLAYER_SAVAGE",
"VEHICLE_WEAPON_TURRET_LIMO",
"VEHICLE_WEAPON_CANNON_BLAZER",
"VEHICLE_WEAPON_TURRET_BOXVILLE",
"VEHICLE_WEAPON_RUINER_BULLET",
"PICKUP_VEHICLE_WEAPON_ASSAULTSMG",
"PICKUP_VEHICLE_WEAPON_PISTOL50",
"PICKUP_AMMO_BULLET_MP",
"PICKUP_AMMO_MISSILE_MP",
"PICKUP_AMMO_GRENADELAUNCHER_MP",
"PICKUP_WEAPON_ASSAULTRIFLE",
"PICKUP_WEAPON_CARBINERIFLE",
"PICKUP_WEAPON_ADVANCEDRIFLE",
"PICKUP_WEAPON_MG",
"PICKUP_WEAPON_COMBATMG",
"PICKUP_WEAPON_SNIPERRIFLE",
"PICKUP_WEAPON_HEAVYSNIPER",
"PICKUP_WEAPON_MICROSMG",
"PICKUP_WEAPON_SMG",
"PICKUP_ARMOUR_STANDARD",
"PICKUP_WEAPON_RPG",
"PICKUP_WEAPON_MINIGUN",
"PICKUP_HEALTH_STANDARD",
"PICKUP_WEAPON_SAWNOFFSHOTGUN",
"PICKUP_WEAPON_ASSAULTSHOTGUN",
"PICKUP_WEAPON_GRENADE",
"PICKUP_WEAPON_MOLOTOV",
"PICKUP_WEAPON_SMOKEGRENADE",
"PICKUP_WEAPON_STICKYBOMB",
"PICKUP_WEAPON_APPISTOL",
"PICKUP_WEAPON_GRENADELAUNCHER",
"PICKUP_MONEY_VARIABLE",
"PICKUP_WEAPON_STUNGUN",
"PICKUP_WEAPON_FIREEXTINGUISHER",
"PICKUP_WEAPON_PETROLCAN",
"PICKUP_WEAPON_GolfClub",
"PICKUP_WEAPON_CROWBAR",
"PICKUP_HANDCUFF_KEY",
"PICKUP_CUSTOM_SCRIPT",
"PICKUP_CAMERA",
"PICKUP_PORTABLE_PACKAGE",
"PICKUP_PORTABLE_CRATE_UNFIXED",
"PICKUP_PORTABLE_CRATE_UNFIXED_INCAR",
"PICKUP_MONEY_CASE",
"PICKUP_MONEY_WALLET",
"PICKUP_MONEY_PURSE",
"PICKUP_MONEY_DEP_BAG",
"PICKUP_MONEY_MED_BAG",
"PICKUP_MONEY_PAPER_BAG",
"PICKUP_MONEY_SECURITY_CASE",
"PICKUP_VEHICLE_WEAPON_APPISTOL",
"PICKUP_VEHICLE_WEAPON_PISTOL",
"PICKUP_VEHICLE_WEAPON_GRENADE",
"PICKUP_VEHICLE_WEAPON_MOLOTOV",
"PICKUP_VEHICLE_WEAPON_SMOKEGRENADE",
"PICKUP_VEHICLE_WEAPON_STICKYBOMB",
"PICKUP_VEHICLE_HEALTH_STANDARD",
"PICKUP_VEHICLE_ARMOUR_STANDARD",
"PICKUP_VEHICLE_WEAPON_MICROSMG",
"PICKUP_VEHICLE_WEAPON_SMG",
"PICKUP_VEHICLE_WEAPON_SAWNOFF",
"PICKUP_VEHICLE_CUSTOM_SCRIPT",
"PICKUP_VEHICLE_MONEY_VARIABLE",
"PICKUP_SUBMARINE",
"PICKUP_HEALTH_SNACK",
"PICKUP_AMMO_MG",
"PICKUP_AMMO_GRENADELAUNCHER",
"PICKUP_AMMO_RPG",
"PICKUP_AMMO_MINIGUN",
"PICKUP_WEAPON_BULLPUPRIFLE",
"PICKUP_WEAPON_BOTTLE",
"PICKUP_WEAPON_SNSPISTOL",
"PICKUP_WEAPON_GUSENBERG",
"PICKUP_WEAPON_SPECIALCARBINE",
"PICKUP_WEAPON_DAGGER",
"PICKUP_WEAPON_FIREWORK",
"PICKUP_WEAPON_MUSKET",
"PICKUP_AMMO_FIREWORK",
"PICKUP_AMMO_FIREWORK_MP",
"PICKUP_PORTABLE_DLC_VEHICLE_PACKAGE",
"PICKUP_WEAPON_HEAVYSHOTGUN",
"PICKUP_WEAPON_MARKSMANRIFLE",
"PICKUP_GANG_ATTACK_MONEY",
"PICKUP_WEAPON_PROXMINE",
"PICKUP_WEAPON_HOMINGLAUNCHER",
"PICKUP_AMMO_HOMINGLAUNCHER",
"PICKUP_WEAPON_FLAREGUN",
"PICKUP_AMMO_FLAREGUN",
"PICKUP_WEAPON_MARKSMANPISTOL"
}

BlacklistedVehicles = { -- Vehicles that are detected
"rhino",
"jet",
"FireTruck",
"Barracks",
"Predator",
"Barracks2",
"hyrda",
"volatol",
"lazer",
"hydra",
"bombushka",
"khanjali",
"APC",
"avenger",
"Annihilator",
"Strikeforce",
"Barracks",
"Barrage",
"besra",
"buzzard",
"Cargobob",
"Crusader",
"hunter",
"insurgent",
"starling",
"miljet",
"nokota",
"pyro",
"rogue",
"savage",
"Squaddie",
"titan",
"Valkyrie",
"Vulkan",
"Cargoplane",
"Vigilante"
}

CageObjs = {
	"prop_gold_cont_01",
	"p_med_jet_01_s",
	"p_cablecar_s",
	"p_spinning_anus_s",
	"stt_prop_stunt_tube_l",
	"stt_prop_stunt_tube_speed",
	"stt_prop_stunt_tube_speeda",
	"stt_prop_stunt_tube_speedb",
	"stt_prop_stunt_tube_xs",
	"stt_prop_stunt_tube_xxs",
	"stt_prop_stunt_track_dwuturn",
	"prop_container_01a",
	"prop_container_01b",
	"prop_container_01c",
	"prop_container_01d",
	"prop_container_01e",
	"prop_container_01f",
	"prop_container_01g",
	"prop_container_01h",
	"prop_container_01mb",
	"prop_container_02a",
	"prop_container_03a",
	"prop_container_03b",
	"prop_container_03mb",
	"prop_container_03_ld",
	"prop_container_04a",
	"prop_container_04mb",
	"prop_container_05mb",
	"prop_container_door_mb_l",
	"prop_container_door_mb_r",
	"prop_container_hole",
	"prop_container_ld",
	"prop_container_ld2",
	"prop_container_old1",
	"prop_cs_burger_01",
	"a_c_boar",
	"a_c_cat_01",
	"a_c_chickenhawk",
	"a_c_chimp",
	"a_c_chop",
	"a_c_cormorant",
	"a_c_cow",
	"a_c_coyote",
	"a_c_crow",
	"a_c_deer",
	"a_c_dolphin",
	"a_c_fish",
	"a_c_hen",
	"a_c_humpback",
	"a_c_husky",
	"a_c_killerwhale",
	"a_c_mtlion",
	"a_c_pig",
	"a_c_pigeon",
	"a_c_poodle",
	"a_c_pug",
	"a_c_rabbit_01",
	"a_c_rat",
	"a_c_retriever",
	"a_c_rhesus",
	"a_c_rottweiler"
}


Citizen.CreateThread(function()
	while true do
		Wait(30000)
		TriggerServerEvent("anticheese:timer")
	end
end)

Citizen.CreateThread(function()
	Citizen.Wait(60000)
	while true do
		Citizen.Wait(0)
		local ped = PlayerPedId()
		local posx,posy,posz = table.unpack(GetEntityCoords(ped,true))
		local still = IsPedStill(ped)
		local vel = GetEntitySpeed(ped)
		local ped = PlayerPedId()
		local veh = IsPedInAnyVehicle(ped, true)
		local speed = GetEntitySpeed(ped)
		local para = GetPedParachuteState(ped)
		local flyveh = IsPedInFlyingVehicle(ped)
		local rag = IsPedRagdoll(ped)
		local fall = IsPedFalling(ped)
		local parafall = IsPedInParachuteFreeFall(ped)
		Wait(3000) -- wait 3 seconds and check again

		local more = speed - 9.0 -- avarage running speed is 7.06 so just incase someone runs a bit faster it wont trigger

		local rounds = tonumber(string.format("%.2f", speed))
		local roundm = tonumber(string.format("%.2f", more))


		newx,newy,newz = table.unpack(GetEntityCoords(ped,true))
		newPed = PlayerPedId() -- make sure the peds are still the same, otherwise the player probably respawned
		if GetDistanceBetweenCoords(posx,posy,posz, newx,newy,newz) > 200 and still == IsPedStill(ped) and vel == GetEntitySpeed(ped) and ped == newPed then
			TriggerServerEvent("AntiCheese:NoclipFlag", GetDistanceBetweenCoords(posx,posy,posz, newx,newy,newz))
		end

		if speed > 15.0 and not veh and (para == -1 or para == 0) and not flyveh and not fall and not parafall and not rag then
			--dont activate this, its broken!
			--TriggerServerEvent("AntiCheese:SpeedFlag", rounds, roundm) -- send alert along with the rounded speed and how much faster they are
		end
	end
end)

Citizen.CreateThread(function()
	while true do
		Citizen.Wait(60000)
		local curPed = PlayerPedId()
		local curHealth = GetEntityHealth( curPed )
		SetEntityHealth( curPed, curHealth-2)
		local curWait = math.random(10,150)
		-- this will substract 2hp from the current player, wait 50ms and then add it back, this is to check for hacks that force HP at 200
		Citizen.Wait(curWait)

		if PlayerPedId() == curPed and GetEntityHealth(curPed) == curHealth and GetEntityHealth(curPed) ~= 0 then
			TriggerServerEvent("AntiCheese:HealthFlag", false, curHealth-2, GetEntityHealth( curPed ),curWait )
		elseif GetEntityHealth(curPed) == curHealth-2 then
			SetEntityHealth(curPed, GetEntityHealth(curPed)+2)
		end
		if GetEntityHealth(curPed) > 400 then
			TriggerServerEvent("AntiCheese:HealthFlag", false, GetEntityHealth( curPed )-200, GetEntityHealth( curPed ),curWait )
		end

		if GetPlayerInvincible( PlayerId() ) then -- if the player is invincible, flag him as a cheater and then disable their invincibility
			TriggerServerEvent("AntiCheese:HealthFlag", true, curHealth-2, GetEntityHealth( curPed ),curWait )
		end
	end
end)

Citizen.CreateThread(function()
    while true do
	Citizen.Wait(1)
	ResetEntityAlpha(PlayerPedId())
	local fallin = IsPedFalling(PlayerPedId())
	local ragg = IsPedRagdoll(PlayerPedId())
	local parac = GetPedParachuteState(PlayerPedId())
	if parac >= 0 or ragg or fallin then
		SetEntityMaxSpeed(PlayerPedId(), 80.0)
	else
		SetEntityMaxSpeed(PlayerPedId(), 7.1) -- Counters fast running/swimming by setting max entity speed.
	end
    end
end)

Citizen.CreateThread(function()
	while true do
		Citizen.Wait(120000)
		local weapon = theWeapon
		for _,theWeapon in ipairs(BlacklistedWeapons) do
			Wait(1)
			if HasPedGotWeapon(PlayerPedId(),GetHashKey(theWeapon),false) == 1 then
					TriggerServerEvent("AntiCheese:WeaponFlag", theWeapon )
			end
		end
	end
end)

function ReqAndDelete(object, detach)
	if DoesEntityExist(object) then
		NetworkRequestControlOfEntity(object)
		while not NetworkHasControlOfEntity(object) do
			Citizen.Wait(1)
		end
		if detach then
			DetachEntity(object, 0, false)
		end
		SetEntityCollision(object, false, false)
		SetEntityAlpha(object, 0.0, true)
		SetEntityAsMissionEntity(object, true, true)
		SetEntityAsNoLongerNeeded(object)
		DeleteEntity(object)
	end
end

Citizen.CreateThread(function()
	while true do
		Citizen.Wait(500)
		local ped = PlayerPedId()
		local handle, object = FindFirstObject()
		local finished = false
		repeat
			Wait(1)
			if IsEntityAttached(object) and DoesEntityExist(object) then
				if GetEntityModel(object) == GetHashKey("prop_acc_guitar_01") then
					ReqAndDelete(object, true)
				end
			end
			for i=1,#CageObjs do
				if GetEntityModel(object) == GetHashKey(CageObjs[i]) then
					ReqAndDelete(object, false)
				end
			end
			finished, object = FindNextObject(handle)
		until not finished
		EndFindObject(handle)
	end
end)

Citizen.CreateThread(function()
	while true do
		Citizen.Wait(0)
		if IsPedJumping(PlayerPedId()) then
			local jumplength = 0
			repeat
				Wait(0)
				jumplength=jumplength+1
				local isStillJumping = IsPedJumping(PlayerPedId())
			until not isStillJumping
			if jumplength > 250 then
				TriggerServerEvent("AntiCheese:JumpFlag", jumplength )
			end
		end
	end
end)

Citizen.CreateThread(function()
	while true do
		Citizen.Wait(30000)
			local playerPed = GetPlayerPed(-1)
			Wait(1)
				if playerPed then
					modelfunc(GetVehiclePedIsIn(playerPed, false))
						for _, carModel in ipairs(BlacklistedVehicles) do
					modelfunc(GetClosestVehicle(x, y, z, 100.0, GetHashKey(carModel), 70))
				end
			end
	end
end)

function modelfunc(car)
	if car then
		carModel = GetEntityModel(car)
		carName = GetDisplayNameFromVehicleModel(carModel)

		if isCarBlacklisted(carModel) then
			TriggerServerEvent("AntiCheese:VehicleFlag", carName )
			_DeleteEntity(car)
		end
	end
end

function isCarBlacklisted(model)
	for _, carModel in pairs(BlacklistedVehicles) do
		if model == GetHashKey(carModel) then
			return true
		end
	end
	return false
end

function _DeleteEntity(entity)
	Citizen.InvokeNative(0xAE3CBE5BF394C9C9, Citizen.PointerValueIntInitialized(entity))
end